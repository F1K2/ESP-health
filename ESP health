-- HealthBarScript.lua

local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- Fonction pour créer une barre de santé
local function createHealthBar(parent)
    local healthBar = Instance.new("BillboardGui")
    healthBar.Size = UDim2.new(3, 0, 0.5, 0)
    healthBar.StudsOffset = Vector3.new(0, 2, 0) -- Ajustez cette valeur pour la hauteur au-dessus de la tête
    healthBar.AlwaysOnTop = true
    healthBar.Parent = parent

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundTransparency = 1
    frame.Parent = healthBar

    local healthFrame = Instance.new("Frame")
    healthFrame.Size = UDim2.new(0, 0, 1, 0)
    healthFrame.BackgroundColor3 = Color3.new(0, 1, 0) -- Vert pour santé pleine
    healthFrame.BorderSizePixel = 0
    healthFrame.Parent = frame

    local border = Instance.new("Frame")
    border.Size = UDim2.new(1, 0, 1, 0)
    border.BackgroundTransparency = 1
    border.BorderSizePixel = 1
    border.BorderColor3 = Color3.new(0, 0, 0) -- Bordure noire
    border.Parent = frame

    return healthFrame, healthBar
end

local function updateHealthBar(healthFrame, humanoid)
    healthFrame.Size = UDim2.new(humanoid.Health / humanoid.MaxHealth, 0, 1, 0)
    healthFrame.BackgroundColor3 = Color3.new(1 - (humanoid.Health / humanoid.MaxHealth), humanoid.Health / humanoid.MaxHealth, 0)
end

-- Fonction pour surveiller la santé des ennemis
local function monitorEnemyHealth(enemy)
    if not enemy.Character then return end
    local humanoid = enemy.Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        local healthFrame, healthBar = createHealthBar(enemy.Character.Head)
        
        local function onHealthChanged(newHealth)
            updateHealthBar(healthFrame, humanoid)
        end
        
        humanoid.HealthChanged:Connect(onHealthChanged)
        
        -- Si le personnage meurt, on nettoie la barre de santé
        humanoid.Died:Connect(function()
            healthBar:Destroy()
        end)
        
        -- Initial update
        updateHealthBar(healthFrame, humanoid)
    end
end

-- Surveille tous les joueurs sauf le joueur local
for _, enemy in ipairs(Players:GetPlayers()) do
    if enemy ~= player then
        monitorEnemyHealth(enemy)
    end
end

-- Surveille les nouveaux joueurs qui rejoignent le jeu
Players.PlayerAdded:Connect(function(newPlayer)
    if newPlayer ~= player then
        monitorEnemyHealth(newPlayer)
    end
end)
